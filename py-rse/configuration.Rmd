# Program Configuration {#py-rse-configuration}

In previous chapters we've used command-line options to configure our word count scripts. 
Depending on how complex we'd like to make our program,
there are actually a number of layers of configuration that we could use:

1.  A system-wide configuration file for general settings.
2.  A user-specific configuration file for personal preferences.
3.  A job-specific file with settings for a specific run.
4.  Command-line options to change things that commonly change.

This is sometimes called [overlay configuration][overlay-configuration]
because each level overrides the ones above it:
the user's configuration file overrides the system settings,
the job configuration overrides the user's defaults,
and the command-line options overrides that.
While this is far more complexity than most research software needs (at least initially),
being able to read a complete set of options from a file is a big boost to reproducibility.

Programmers have invented many formats for configuration files,
so please do not create your own.
One possibility is to write the configuration as a Python data structure
and then load it as if it was a library.
This is clever,
but it's hard for tools in other languages to process.
A second option is the [Windows INI format][ini-format],
which is laid out like this:

```text
[section_1]
key_1=value_1
key_2=value_2

[section_2]
key_3=value_3
key_4=value_4
```

INI files are simple to read and write,
but the format is slowly falling out of use in favor of [YAML][yaml]
(AppendixÂ \@ref(py-rse-yaml)).
Here's a sample YAML configuration file:

```yaml
# Standard settings for thesis.
logfile: "/tmp/log.txt"
quiet: false
overwrite: false
fonts:
- Verdana
- Serif
```

TODO:

This chapter introduces overlay configuration and applies it by
adding relevant functionality to `plotcounts.py`.
Specifically, the program will accept a YAML file to configure aspects of [`matplotlib.rcParams`](https://matplotlib.org/3.1.1/tutorials/introductory/customizing.html).

Note (from that hyperlink) that there is an rcParams configuration file
somewhere on your system, but by default everything is commented out.
You can find it by using:

```python
>>> import matplotlib as mpl
>>> mpl.matplotlib_fname()
/Users/damienirving/anaconda/envs/merely/lib/python3.7/site-packages/matplotlib/mpl-data/matplotlibrc
```

To put this all in context, this chapter talks about the following levels of configuration:

1. A system-wide configuration file for general settings.
2. A user-specific configuration file for personal preferences. [e.g. `matplotlibrc`]
3. A job-specific file with settings for a specific run. [e.g. `zipfs_law/bin/plot_params.yml`]
4. Command-line options to change things that commonly change. [e.g. `argparse`]

At the end of this chapter the `plotcounts.py` script should look like
`zipfs_law/bin/plotcounts_config.py`.


## Exercises {#py-rse-configuration-exercises}

TODO

## Key Points {#py-rse-configuration-keypoints}

```{r, child="keypoints/py-rse-configuration.md"}
```

```{r, child="./links.md"}
```
